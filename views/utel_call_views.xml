<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- =============== LIST (was tree) =============== -->
    <record id="view_utel_call_list" model="ir.ui.view">
        <field name="name">utel.call.list</field>
        <field name="model">utel.call</field>
        <field name="arch" type="xml">
            <list string="Utel Calls" create="0" delete="0">
                <field name="date_time"/>
                <field name="type"/>
                <field name="src" string="From"/>
                <field name="dst" string="To"/>
                <field name="external_number" string="External Number"/>

                <!-- Human-readable durations (computed/related in Python) -->
                <field name="talk_time_display" string="Talk Time"/>
                <field name="ring_time_display" string="Ring Time"/>

                <field name="status"/>

                <!-- Buttons: use 'invisible' expressions (no attrs/states) -->
                <button name="action_open_play"
                        type="object"
                        string="Play"
                        class="oe_link"
                        invisible="not has_recording"/>
                <button name="action_open_download"
                        type="object"
                        string="Download"
                        class="oe_link"
                        invisible="not download_url"/>
            </list>
        </field>
    </record>

    <!-- =============== FORM =============== -->
    <record id="view_utel_call_form" model="ir.ui.view">
        <field name="name">utel.call.form</field>
        <field name="model">utel.call</field>
        <field name="arch" type="xml">
            <form string="Utel Call" create="0" delete="0" edit="0">
                <sheet>
                    <group>
                        <group>
                            <field name="date_time"/>
                            <field name="type"/>
                            <field name="status"/>
                        </group>
                        <group>
                            <field name="src" string="From"/>
                            <field name="dst" string="To"/>
                            <field name="external_number" string="External Number"/>
                        </group>
                    </group>

                    <group string="Durations">
                        <field name="talk_time" invisible="1"/>
                        <field name="ring_time" invisible="1"/>
                        <field name="talk_time_display" readonly="1"/>
                        <field name="ring_time_display" readonly="1"/>
                    </group>

                    <group string="Recording">
                        <field name="has_recording" readonly="1"/>
                        <field name="play_url" readonly="1"/>
                        <field name="download_url" readonly="1"/>
                        <!-- Embedded compact player (computed HTML) -->
                        <field name="player_html" readonly="1" nolabel="1"/>
                        <button name="action_open_play"
                                type="object"
                                string="Open Player"
                                class="btn-secondary"
                                invisible="not has_recording"/>
                        <button name="action_open_download"
                                type="object"
                                string="Download"
                                class="btn-primary"
                                invisible="not download_url"/>
                    </group>

                    <notebook>
                        <page string="Notes">
                            <field name="note"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =============== SEARCH =============== -->
    <record id="view_utel_call_search" model="ir.ui.view">
        <field name="name">utel.call.search</field>
        <field name="model">utel.call</field>
        <field name="arch" type="xml">
            <search string="Search Calls">
                <field name="src" filter_domain="[('src','ilike',self)]"/>
                <field name="dst" filter_domain="[('dst','ilike',self)]"/>
                <field name="external_number" filter_domain="[('external_number','ilike',self)]"/>
                <filter string="With Recording" name="with_recording" domain="[('has_recording','=',True)]"/>
                <filter string="Incoming" name="incoming" domain="[('type','=','in')]"/>
                <filter string="Outgoing" name="outgoing" domain="[('type','=','out')]"/>
                <filter string="Missed" name="missed" domain="[('type','=','missed')]"/>
                <separator/>
                <filter string="Today" name="today" domain="[('date_time','&gt;=', context_today())]"/>
            </search>
        </field>
    </record>

    <!-- =============== ACTION =============== -->
    <record id="action_utel_calls" model="ir.actions.act_window">
        <field name="name">Utel Calls</field>
        <field name="res_model">utel.call</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_utel_call_list"/>
        <field name="context">{}</field>
        <field name="target">current</field>
        <field name="search_view_id" ref="view_utel_call_search"/>
    </record>

    <!-- =============== MENUS (Calls) =============== -->
    <!-- Reuse your UTEL root if it already exists -->
    <menuitem id="menu_utel_root"
          name="Utel"
          sequence="10"
          web_icon="utel_integration,static/description/icon.png"/>
    <menuitem id="menu_utel_calls"
              name="Calls"
              parent="menu_utel_root"
              action="action_utel_calls"
              sequence="10"/>

</odoo>
